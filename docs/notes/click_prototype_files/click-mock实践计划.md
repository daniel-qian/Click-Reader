### 完整流程设计
阶段1：技术预处理

- 你负责：epub → chapter JSON文件
- 输出：结构化的章节数据（段落索引、字符偏移）
阶段2：工作流1 - 书籍分析

- 输入：书籍元数据 + 前3章样本
- 输出：风格标签、人物设定、场景描述、提示词模板
阶段3：工作流2 - 章节处理

- 输入：书籍上下文 + 单章节JSON
- 输出：圆点位置 + 图片 + 音频
### 数据库设计
新增5张表：

- book_contexts ：存储书籍风格和人物设定
- chapters ：章节索引和内容URL
- hotspots ：圆点位置和媒体资源
- user_progress ：用户阅读进度
- ai_variations ：用户生成的变化图片

### 关键特性
- 精确定位 ：段落索引+字符偏移，避免字体变化导致错位
- 错误处理 ：失败重试机制，部分失败不影响整体
- 版本控制 ：支持算法更新后的增量处理
- 文件管理 ：OSS路径规则，支持CDN加速